<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YALLA RIDE | Ultimate Team Portal</title>
    
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --sky-blue: #00d4ff;
            --bg-dark: #080a0f;
            --card-bg: rgba(22, 27, 34, 0.9);
            --transition: 0.3s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; scroll-behavior: smooth; overflow-x: hidden; }

        /* Navigation */
        nav { position: fixed; top: 0; width: 100%; padding: 20px 10%; display: flex; justify-content: space-between; align-items: center; background: rgba(8, 10, 15, 0.9); z-index: 1000; backdrop-filter: blur(10px); border-bottom: 1px solid #1f262e; }
        .logo { IMG_0660.PNG; }
        .nav-links { display: flex; gap: 20px; list-style: none; }
        .nav-links a { color: white; text-decoration: none; font-size: 0.9rem; text-transform: uppercase; transition: var(--transition); }
        .nav-links a:hover { color: var(--sky-blue); }

        /* Hero */
        .hero { height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background: linear-gradient(rgba(8,10,15,0.6), var(--bg-dark)), url('https://images.unsplash.com/photo-1474135980689-e24f4e706918?q=80&w=2000'); background-size: cover; background-position: center; }
        .hero h1 { font-size: clamp(3rem, 10vw, 5rem); text-transform: uppercase; letter-spacing: 10px; }

        /* Common Styles */
        .section { padding: 80px 10%; text-align: center; }
        .section-title { font-size: 2.5rem; margin-bottom: 50px; text-transform: uppercase; }
        .section-title span { color: var(--sky-blue); }
        .sports-card { background: var(--card-bg); padding: 30px; border-radius: 20px; border: 1px solid #30363d; margin: 0 auto; transition: var(--transition); position: relative; }

        /* Auth Modal */
        .auth-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(8, 10, 15, 0.95); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .auth-card { width: 90%; max-width: 400px; border: 1px solid var(--sky-blue); }
        input { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; margin-bottom: 15px; }

        /* Tracker */
        .progress-track { height: 20px; background: #21262d; transform: skewX(-15deg); margin: 25px 0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: var(--sky-blue); transition: 0.5s ease; box-shadow: 0 0 15px var(--sky-blue); }
        input[type="range"] { width: 100%; accent-color: var(--sky-blue); cursor: pointer; }

        /* Leaderboard Table */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; text-align: left; }
        th { color: var(--sky-blue); padding: 15px; border-bottom: 1px solid #30363d; font-size: 0.8rem; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #1f262e; font-size: 0.9rem; }

        .btn-main { padding: 15px 40px; background: var(--sky-blue); color: black; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; transition: var(--transition); text-transform: uppercase; }
        .btn-main:hover { box-shadow: 0 0 30px var(--sky-blue); transform: translateY(-3px); }
        
        footer { padding: 40px; text-align: center; color: #8b949e; font-size: 0.8rem; border-top: 1px solid #1f262e; }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo"><i class="fas fa-bicycle"></i> YALLA RIDE</a>
        <ul class="nav-links">
            <li><a href="#home">Home</a></li>
            <li><a href="#dashboard">Tracker</a></li>
            <li><a href="#leaderboard">Leaderboard</a></li>
            <li id="authLink"><a href="javascript:void(0)" onclick="openAuth()">Login / Join</a></li>
            <li id="userLink" style="display:none;"><a href="javascript:void(0)" onclick="logout()">Logout</a></li>
        </ul>
    </nav>

    <div id="authModal" class="auth-overlay">
        <div class="sports-card auth-card">
            <h2 id="authTitle">RIDER <span>LOGIN</span></h2>
            <form id="authForm">
                <input type="email" id="authEmail" placeholder="EMAIL ADDRESS" required>
                <input type="password" id="authPassword" placeholder="PASSWORD" required>
                <button type="submit" class="btn-main" style="width: 100%;">START RIDING</button>
            </form>
            <p id="toggleAuth" style="margin-top: 15px; cursor: pointer; font-size: 0.8rem; color: #8b949e;">
                Don't have an account? <span style="color: var(--sky-blue);">Register Here</span>
            </p>
            <button onclick="closeAuth()" style="background:none; border:none; color:grey; margin-top:10px; cursor:pointer;">Close</button>
        </div>
    </div>

    <section class="hero" id="home">
        <h1>YALLA RIDE</h1>
        <p>REDEFINING ADVENTURE ON TWO WHEELS</p>
    </section>

    <section class="section" id="dashboard">
        <h2 class="section-title">Ride <span>Tracker</span></h2>
        <div class="sports-card" id="captureArea" style="max-width: 450px;">
            <div id="userDisplay" style="margin-bottom:15px; font-weight: bold; color: var(--sky-blue);">Guest Rider</div>
            <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: #8b949e;">
                <span id="label-1">Beginner</span>
                <span id="label-2">Intermediate</span>
                <span id="label-3">Advanced</span>
            </div>
            <div class="progress-track"><div class="progress-fill" id="fill"></div></div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div id="levelDisplay" style="font-weight: bold; font-style: italic;">LEVEL</div>
                <div style="font-size: 2rem;"><span id="kmVal">0</span><small style="font-size: 0.8rem;"> KM</small></div>
            </div>
            <input type="range" id="rideSlider" min="0" max="1000" value="0">
            <p style="font-size:0.7rem; color:grey; margin-top:10px;">Your progress updates the leaderboard in real-time.</p>
        </div>
    </section>

    <section class="section" id="leaderboard" style="background: #0d1117;">
        <h2 class="section-title">Global <span>Leaderboard</span></h2>
        <div class="sports-card" style="max-width: 600px;">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Rider</th>
                        <th style="text-align: right;">Distance</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    </tbody>
            </table>
        </div>
    </section>

    <footer>
        <p>© 2026 YALLA RIDE TEAM • Stay Safe, Wear a Helmet.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Helpers
        const authModal = document.getElementById('authModal');
        const rideSlider = document.getElementById('rideSlider');
        let isLoginMode = true;

        window.openAuth = () => authModal.style.display = 'flex';
        window.closeAuth = () => authModal.style.display = 'none';
        window.logout = () => signOut(auth);

        document.getElementById('toggleAuth').onclick = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerHTML = isLoginMode ? "RIDER <span>LOGIN</span>" : "NEW <span>RIDER</span>";
            document.getElementById('toggleAuth').innerHTML = isLoginMode ? "Don't have an account? <span>Register</span>" : "Already a rider? <span>Login</span>";
        };

        // Badge Logic
        function getBadge(km) {
            if (km >= 1000) return '<i class="fas fa-medal" style="color: #ffd700;" title="Gold Rider"></i>';
            if (km >= 500) return '<i class="fas fa-award" style="color: #c0c0c0;" title="Silver Rider"></i>';
            if (km >= 100) return '<i class="fas fa-certificate" style="color: #cd7f32;" title="Bronze Rider"></i>';
            return '';
        }

        // Auth Form Submission
        document.getElementById('authForm').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    const res = await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, "riders", res.user.uid), { totalKm: 0, email: email });
                }
                closeAuth();
            } catch (err) { alert(err.message); }
        };

        // Track User Session & Sync
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('authLink').style.display = 'none';
                document.getElementById('userLink').style.display = 'block';
                document.getElementById('userDisplay').innerText = `Welcome, ${user.email.split('@')[0]}`;
                
                onSnapshot(doc(db, "riders", user.uid), (snap) => {
                    if (snap.exists()) updateUI(snap.data().totalKm);
                });
            } else {
                document.getElementById('authLink').style.display = 'block';
                document.getElementById('userLink').style.display = 'none';
                document.getElementById('userDisplay').innerText = "Guest Rider";
                updateUI(0);
            }
        });

        // Global Leaderboard
        function syncLeaderboard() {
            const q = query(collection(db, "riders"), orderBy("totalKm", "desc"), limit(10));
            onSnapshot(q, (snap) => {
                const tbody = document.getElementById('leaderboardBody');
                tbody.innerHTML = "";
                snap.docs.forEach((doc, i) => {
                    const data = doc.data();
                    tbody.innerHTML += `
                        <tr>
                            <td>#${i+1}</td>
                            <td style="display:flex; align-items:center; gap:10px;">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${data.email}" style="width:25px; border-radius:50%">
                                ${data.email.split('@')[0]} ${getBadge(data.totalKm)}
                            </td>
                            <td style="text-align:right; color:var(--sky-blue); font-weight:bold;">${data.totalKm} KM</td>
                        </tr>
                    `;
                });
            });
        }
        syncLeaderboard();

        // Update UI
        function updateUI(val) {
            const fill = document.getElementById('fill');
            const kmVal = document.getElementById('kmVal');
            const levelDisplay = document.getElementById('levelDisplay');
            const labels = [document.getElementById('label-1'), document.getElementById('label-2'), document.getElementById('label-3')];
            
            rideSlider.value = val;
            fill.style.width = (val / 10) + '%'; // Scale 1000km to 100%
            kmVal.innerText = val;

            let color = "#00d4ff"; let text = "BEGINNER"; let idx = 0;
            if (val >= 100 && val < 500) { color = "#ffd700"; text = "INTERMEDIATE"; idx = 1; }
            else if (val >= 500) { color = "#ff0077"; text = "ADVANCED"; idx = 2; }

            levelDisplay.innerHTML = `${text} ${getBadge(val)}`;
            levelDisplay.style.color = color;
            fill.style.background = color;
            fill.style.boxShadow = `0 0 15px ${color}`;
            labels.forEach((l, i) => l.style.color = i === idx ? color : "#8b949e");
        }

        // Save Slider change to Firebase
        rideSlider.addEventListener('change', async (e) => {
            const user = auth.currentUser;
            if (user) {
                await updateDoc(doc(db, "riders", user.uid), { totalKm: parseInt(e.target.value) });
            } else {
                openAuth();
            }
        });
    </script>
</body>
</html>
