<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YALLA RIDE | Official</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00d2ff;
            --dark: #0b0e11;
            --card: #15191d;
            --nav: #1a1f24;
            --gold: #ffcf33;
            --danger: #ff4d4d;
            --text: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--dark); color: var(--text); overflow-x: hidden; }

        /* Navigation */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5%; background: var(--nav); height: 80px;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #333;
        }
        .logo-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .main-logo { height: 55px; width: 55px; object-fit: contain; } /* Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ */
        .brand-name { font-weight: 900; color: var(--primary); font-size: 1.2rem; }
        
        .nav-links { display: flex; gap: 20px; list-style: none; align-items: center; }
        .nav-links li a { color: #aaa; text-decoration: none; font-size: 1.1rem; cursor: pointer; transition: 0.3s; }
        .nav-links li a:hover { color: var(--primary); }

        /* Notification Badge */
        .notif-wrapper { position: relative; }
        .notif-badge { 
            position: absolute; top: -5px; right: -8px; 
            background: var(--danger); color: white; 
            width: 18px; height: 18px; border-radius: 50%; 
            font-size: 0.65rem; display: none; align-items: center; 
            justify-content: center; font-weight: bold; border: 2px solid var(--nav);
        }
        .ring { animation: ring-animation 2s infinite; color: var(--gold) !important; }
        @keyframes ring-animation {
            0% { transform: rotate(0); } 10% { transform: rotate(15deg); } 20% { transform: rotate(-15deg); } 0% { transform: rotate(0); }
        }

        /* Pages */
        .page { display: none; padding: 30px 5%; animation: slideUp 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .container { max-width: 550px; margin: auto; }
        .card { background: var(--card); border-radius: 25px; padding: 30px; border: 1px solid #222; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        /* Profile Image Styling */
        .profile-img-box { position: relative; width: 140px; height: 140px; margin: 0 auto 20px; }
        .profile-img-box img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); background: #222; }
        .camera-icon { position: absolute; bottom: 5px; right: 5px; background: var(--primary); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid var(--card); color: black; }

        /* Buttons & Inputs */
        button { width: 100%; padding: 14px; margin-top: 15px; border-radius: 12px; border: none; background: var(--primary); color: #000; font-weight: 900; cursor: pointer; transition: 0.3s; }
        button:hover { transform: scale(1.02); filter: brightness(1.1); }
        input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; background: #1e252b; border: 1px solid #333; color: white; outline: none; }
        
        .ride-card { background: #1e252b; border-radius: 20px; padding: 20px; margin-bottom: 15px; border-right: 5px solid var(--primary); }
        .admin-item { display: flex; justify-content: space-between; align-items: center; background: #1a1f24; padding: 15px; border-radius: 15px; margin-bottom: 10px; }
        .mini-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; margin-left: 10px; border: 2px solid var(--primary); }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: black; padding: 12px 30px; border-radius: 50px; display: none; z-index: 9999; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<audio id="notif-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

<nav>
    <div class="logo-container" onclick="showPage('home')">
        <img src="IMG_0660.PNG" alt="Logo" class="main-logo" onerror="this.src='https://via.placeholder.com/55/222222/00d2ff?text=Y'">
        <span class="brand-name">YALLA RIDE</span>
    </div>
    
    <ul class="nav-links">
        <li><a onclick="showPage('home')"><i class="fa-solid fa-house"></i></a></li>
        <li class="notif-wrapper" onclick="showPage('rides')">
            <i class="fa-solid fa-bell" id="bell-icon"></i>
            <div id="notif-count" class="notif-badge">0</div>
        </li>
        <li><a onclick="showPage('leaderboard')"><i class="fa-solid fa-ranking-star"></i></a></li>
        <li id="nav-admin" class="hidden"><a onclick="showPage('admin')"><i class="fa-solid fa-user-gear" style="color:var(--gold)"></i></a></li>
        <li id="nav-profile" class="hidden"><a onclick="showPage('profile')"><i class="fa-solid fa-circle-user"></i></a></li>
        <li id="nav-login"><a onclick="showPage('login')"><i class="fa-solid fa-right-to-bracket"></i></a></li>
    </ul>
</nav>

<div id="home" class="page active" style="text-align:center;">
    <div style="margin-top: 15vh;">
        <img src="IMG_0660.PNG" style="width: 150px; margin-bottom: 20px;" onerror="this.style.display='none'">
        <h1 style="font-size: 3.5rem; font-weight: 900;">YALLA RIDE</h1>
        <p style="color:var(--gold); letter-spacing: 4px; font-weight: bold;">KEEP ROLLING YOUR WHEELS</p>
        <button onclick="showPage('rides')" style="width: 220px; margin-top: 40px; background: transparent; border: 2px solid var(--primary); color: var(--primary);">Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</button>
    </div>
</div>

<div id="profile" class="page">
    <div class="container card" style="text-align:center;">
        <div class="profile-img-box">
            <img id="user-pic" src="https://via.placeholder.com/140/222222/00d2ff?text=User" alt="Profile">
            <label for="img-upload" class="camera-icon">
                <i class="fa-solid fa-camera"></i>
            </label>
            <input type="file" id="img-upload" hidden accept="image/*" onchange="uploadPhoto(this)">
        </div>
        <h2 id="display-name">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
        <div id="user-badges" style="margin-top: 5px;"></div>
        
        <div style="background:#1a1f24; padding:25px; border-radius:20px; margin:25px 0;">
            <p style="color:#888;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</p>
            <h1 style="color:var(--primary); font-size: 3rem;"><span id="display-km">0</span> <small style="font-size: 1rem;">ÙƒÙ…</small></h1>
        </div>
        <button onclick="logout()" style="background:var(--danger); color:white;"><i class="fa-solid fa-power-off"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="rides" class="page">
    <div class="container">
        <h2 style="text-align:center; margin-bottom:20px;"><i class="fa-solid fa-route"></i> Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
        <div id="rides-list"></div>
    </div>
</div>

<div id="leaderboard" class="page">
    <div class="container card">
        <h2 style="text-align:center; margin-bottom:20px;"><i class="fa-solid fa-trophy" style="color:var(--gold)"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
        <div id="leaderboard-list"></div>
    </div>
</div>

<div id="admin" class="page">
    <div class="container card">
        <h3>ğŸ“¢ Ù†Ø´Ø± Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="ride-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬ÙˆÙ„Ø©">
        <input type="text" id="ride-info" placeholder="Ø§Ù„ÙˆÙ‚Øª ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„ØªØ¬Ù…Ø¹">
        <button onclick="addRide()"><i class="fa-solid fa-paper-plane"></i> Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
        <hr style="margin:25px 0; border:0.5px solid #333;">
        <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª</h3>
        <div id="admin-results"></div>
    </div>
</div>

<div id="login" class="page">
    <div class="container card">
        <h2 id="auth-title" style="text-align:center;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="text" id="reg-name" class="hidden" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="email" id="auth-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="auth-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button onclick="handleAuth()">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        <p onclick="toggleAuth()" style="cursor:pointer; text-align:center; margin-top:15px; color:var(--primary);">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</p>
    </div>
</div>

<div id="toast"></div>

<script>
    let users = JSON.parse(localStorage.getItem('yalla_final_db')) || [];
    let rides = JSON.parse(localStorage.getItem('yalla_rides')) || [];
    let currentUser = JSON.parse(sessionStorage.getItem('yalla_session')) || null;
    let lastSeenCount = parseInt(localStorage.getItem('last_seen')) || 0;

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'profile') renderProfile();
        if(id === 'leaderboard') renderLeaderboard();
        if(id === 'rides') {
            renderRides();
            lastSeenCount = rides.length;
            localStorage.setItem('last_seen', lastSeenCount);
            updateNotif();
        }
        if(id === 'admin') renderAdmin();
    }

    function uploadPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                document.getElementById('user-pic').src = imageData;
                currentUser.pic = imageData;
                sessionStorage.setItem('yalla_session', JSON.stringify(currentUser));
                const uIndex = users.findIndex(u => u.email === currentUser.email);
                if(uIndex !== -1) {
                    users[uIndex].pic = imageData;
                    localStorage.setItem('yalla_final_db', JSON.stringify(users));
                }
                notify("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function renderProfile() {
        if(!currentUser) return;
        document.getElementById('display-name').innerText = currentUser.name;
        document.getElementById('display-km').innerText = currentUser.km || 0;
        document.getElementById('user-badges').innerHTML = getBadges(currentUser.km || 0);
        if(currentUser.pic) document.getElementById('user-pic').src = currentUser.pic;
    }

    function updateNotif() {
        const count = rides.length - lastSeenCount;
        const badge = document.getElementById('notif-count');
        const bell = document.getElementById('bell-icon');
        if(count > 0) {
            badge.innerText = count;
            badge.style.display = 'flex';
            bell.classList.add('ring');
            if(sessionStorage.getItem('played') != rides.length) {
                document.getElementById('notif-sound').play().catch(()=>{});
                sessionStorage.setItem('played', rides.length);
            }
        } else {
            badge.style.display = 'none';
            bell.classList.remove('ring');
        }
    }

    function getBadges(km) {
        let h = '';
        if(km >= 10) h += '<i class="fa-solid fa-medal" style="color:#cd7f32; margin:0 3px;"></i>';
        if(km >= 50) h += '<i class="fa-solid fa-medal" style="color:#c0c0c0; margin:0 3px;"></i>';
        if(km >= 100) h += '<i class="fa-solid fa-award" style="color:#ffd700; margin:0 3px;"></i>';
        if(km >= 250) h += '<i class="fa-solid fa-fire" style="color:#ff4d4d; margin:0 3px;"></i>';
        return h;
    }

    function renderLeaderboard() {
        const list = document.getElementById('leaderboard-list');
        list.innerHTML = [...users].sort((a,b)=>b.km-a.km).map((u, i) => `
            <div class="admin-item">
                <div style="display:flex; align-items:center;">
                    <span style="width:20px; font-weight:bold;">${i+1}</span>
                    <img src="${u.pic || 'https://via.placeholder.com/45/222'}" class="mini-avatar">
                    <div><b>${u.name}</b><br>${getBadges(u.km)}</div>
                </div>
                <span style="color:var(--primary); font-weight:900;">${u.km} <small>ÙƒÙ…</small></span>
            </div>`).join('');
    }

    function renderRides() {
        document.getElementById('rides-list').innerHTML = rides.length ? rides.map(r => `
            <div class="ride-card">
                <small style="color:var(--gold)"><i class="fa-regular fa-clock"></i> ${r.date}</small>
                <h3 style="color:var(--primary); margin:5px 0;">${r.title}</h3>
                <p style="color:#ccc; font-size:0.9rem;"><i class="fa-solid fa-location-dot"></i> ${r.info}</p>
            </div>`).reverse().join('') : '<p style="text-align:center; color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø§Øª Ù‚Ø±ÙŠØ¨Ø©</p>';
    }

    function renderAdmin() {
        document.getElementById('admin-results').innerHTML = users.map((u, idx) => `
            <div class="admin-item">
                <span>${u.name}</span>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="km-${idx}" value="${u.km}" style="width:70px; margin:0; height:40px;">
                    <button onclick="saveKm(${idx})" style="width:50px; margin:0; height:40px; padding:0;"><i class="fa-solid fa-check"></i></button>
                </div>
            </div>`).join('');
    }

    function saveKm(idx) {
        users[idx].km = parseFloat(document.getElementById(`km-${idx}`).value) || 0;
        localStorage.setItem('yalla_final_db', JSON.stringify(users));
        notify("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }

    function addRide() {
        const t = document.getElementById('ride-title').value;
        const i = document.getElementById('ride-info').value;
        if(!t || !i) return notify("âŒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        rides.push({ id: Date.now(), title: t, info: i, date: new Date().toLocaleDateString('ar-SA') });
        localStorage.setItem('yalla_rides', JSON.stringify(rides));
        notify("ğŸš€ ØªÙ… Ø§Ù„Ù†Ø´Ø±!");
        updateNotif();
    }

    function handleAuth() {
        const e = document.getElementById('auth-email').value;
        const p = document.getElementById('auth-pass').value;
        const n = document.getElementById('reg-name').value;
        const isReg = !document.getElementById('reg-name').classList.contains('hidden');

        if(e === "dev@yallaride.com" && p === "Dev2026") {
            currentUser = { name: "Ø§Ù„Ù…Ø·ÙˆØ±", email: e, isAdmin: true };
            sessionStorage.setItem('yalla_session', JSON.stringify(currentUser));
            updateNav(); showPage('admin'); return;
        }

        if(isReg) {
            if(!n || !e) return notify("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
            users.push({ name: n, email: e, pass: p, km: 0, pic: '' });
            localStorage.setItem('yalla_final_db', JSON.stringify(users));
            notify("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„! Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù†");
            toggleAuth();
        } else {
            const user = users.find(u => u.email === e && u.pass === p);
            if(user) {
                currentUser = user;
                sessionStorage.setItem('yalla_session', JSON.stringify(currentUser));
                updateNav();
                showPage('profile');
            } else notify("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        }
    }

    function toggleAuth() {
        document.getElementById('reg-name').classList.toggle('hidden');
        document.getElementById('auth-title').innerText = document.getElementById('reg-name').classList.contains('hidden') ? "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨";
    }

    function updateNav() {
        document.getElementById('nav-profile').classList.toggle('hidden', !currentUser);
        document.getElementById('nav-login').classList.toggle('hidden', !!currentUser);
        document.getElementById('nav-admin').classList.toggle('hidden', !currentUser || currentUser.email !== "dev@yallaride.com");
    }

    function logout() { currentUser = null; sessionStorage.clear(); updateNav(); showPage('home'); }
    function notify(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none', 2500); }

    updateNav();
    updateNotif();
</script>
</body>
</html>
